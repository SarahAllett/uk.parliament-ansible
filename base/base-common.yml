- hosts: tag_Name_core_gocd_agent_ansible_1 core-nginx-proxy-1 tag_Name_core_grafana_server tag_Name_core_influxdb_server
  vars:
    datadog_api_key: "{{credstash_query_output.stdout}}"
    datadog_config:
      hostname: "{{ ec2_tag_Account}}-{{ ec2_tag_Name }}-{{ inventory_hostname}}"
      expvar_port: 5050
      cmd_port: 5051
  user: ubuntu
  become: yes
  become_method: sudo

  roles:
    - role: packages-ubuntu
    - role: users
    - role: datadog
    - role: filebeat-ubuntu

- hosts: core-nginx-proxy-1
  user: ubuntu
  become: yes
  become_method: sudo
  roles:
    - role: filebeat-nginx

- hosts: key_ecs_instances

  vars:
    datadog_api_key: "{{credstash_query_output.stdout}}"
    datadog_config:
      hostname: "{{ ec2_tag_Account}}-{{ ec2_tag_Name }}-{{ inventory_hostname}}"
      expvar_port: 5050
      cmd_port: 5051
  user: ec2-user
  become: yes
  become_method: sudo

  roles:
    - role: packages-centos
    - role: users
    - role: datadog
    - role: datadog-docker



- hosts: tag_Name_core_freeipa_master_1
  vars:
    datadog_api_key: "{{credstash_query_output.stdout}}"
    datadog_config:
      hostname: "{{ ec2_tag_Account}}-{{ ec2_tag_Name }}-{{ inventory_hostname}}"
  user: fedora
  become: yes
  become_method: sudo

  roles:
     - role: packages-centos
     - role: users
     - role: datadog
     - role: filebeat-centos

- hosts: tag_Name_core-gocd-agent-ansible-1
  user: ubuntu
  become: yes
  become_method: sudo
  roles:
    - role: packer
