# amend freeip virtual hosts file to change proxy_pass http:// to proxy_pass https://

-  lineinfile:
       path: /etc/nginx/sites-available/freeipa.conf
       regexp: 'proxy_pass'
       line: 'proxy_pass https://172.16.40.168;'
   notify:
      - Test nginx and reload

# Add route to web1live subnet for GoCD Server connection

- lineinfile:
       path: /etc/network/interfaces
       line: 'up route add -net 172.16.136.0/24 gw 172.16.40.1'
  notify:
      - Restart networking

# Add route to web1dev subnet for GoCD Server connection

- lineinfile:
       path: /etc/network/interfaces
       line: 'up route add -net 172.16.128.0/24 gw 172.16.40.1'
  notify:
      - Restart networking

# Install Filebeat

- shell: curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.2.1-amd64.deb
- shell: dpkg -i filebeat-6.2.1-amd64.deb





- copy:
    src: ../../files/filebeat/filebeat-nginx-proxy.yml
    dest: /etc/filebeat/filebeat.yml
    owner: root
    group: root
    mode: 0600


- service:
    name: filebeat
    state: restarted
